\section{Discretization of the IPM system}
\label{sec:framework}
\subsection{Finite Volume Discretization}
In the following, we discretize the moment system in space and time according to \cite{kusch2017maximum}. Due to the fact, that stochastic-Galerkin can be interpreted as IPM with a quadratic entropy, it suffices to only derive a discretization of the IPM moment system \eqref{eq:SGMomentSystem}.  
Omitting initial conditions and assuming a one-dimensional spatial domain, we can write this system  as
\begin{align*}
\partial_t \bm{\hat u}+\partial_x \bm{F}(\bm{\hat u}) = \bm{0}
\end{align*}
with the flux $\bm{F}:\mathbb{R}^{N\times p}\to\mathbb{R}^{N\times p}$, $\bm{F}(\bm{\hat u})=\langle \bm f(\mathcal{U}(\bm{\hat u}))\bm{\varphi}^T \rangle^T$. Due to hyperbolicity of the IPM moment system, one can use a finite-volume method to approximate the time evolution of the IPM moments. We choose the discrete unknowns which represent the solution to be the spatial averages over each cell at time $t_n$, given by
\begin{align*}
\bm{\hat u}_{ij}^n \simeq \frac{1}{\Delta x}\int_{x_{j-1/ 2}}^{x_{j+1/ 2}}\bm{\hat u}_i(t_n,x) dx.
\end{align*}
If a moment vector in cell $j$ at time $t_n$ is denoted as $\bm{\hat u}_j^n = (\bm{\hat u}_{0j}^n,\cdots,\bm{\hat u}_{Nj}^n)^T\in\mathbb{R}^{N+1}$, the finite-volume scheme can be written in conservative form with the numerical flux $\bm{G}:\mathbb{R}^{N\times p}\times\mathbb{R}^{N\times p}\to\mathbb{R}^{N\times p}$ as
\begin{align}\label{eq:IPMDiscretization}
\bm{\hat u}_{j}^{n+1} = \bm{\hat u}_{j}^{n}  - \frac{\Delta t}{\Delta x}\left( \bm{G}(\bm{\hat u}_{j}^{n},\bm{\hat u}_{j+1}^{n})- \bm{G}(\bm{\hat u}_{j-1}^{n},\bm{\hat u}_{j}^{n})\right)
\end{align}
for $j = 1,\cdots,N_x$ and $n = 0,\cdots,N_t$. Here, the number of spatial cells is denoted by $N_x$ and the number of time steps by $N_t$.
The numerical flux is assumed to be consistent, i.e. $\bm{G}(\bm{\hat{u}},\bm{\hat{u}})=\bm{F}(\bm{\hat{u}})$.

When a consistent numerical flux $\bm g:\mathbb{R}^p\times\mathbb{R}^p\to\mathbb{R}^p$, $\bm g = \bm g(\bm u_\ell, \bm u_r)$ is available for the original problem \eqref{eq:hyperbolicProblem}, then for the IPM system we can simply take
\begin{align*}
 \bm{\tilde G}(\bm{\hat u}_{j}^n,\bm{\hat u}_{j+1}^{n}) = \langle \bm g(\mathcal{U}(\bm{\hat u}_j^n),\mathcal{U}(\bm{\hat u}_{j+1}^n))\bm{\varphi}^T\rangle^T.
\end{align*}
Commonly, this integral cannot be evaluated analytically and therefore needs to be approximated by a quadrature rule
\begin{align*}
\langle h \rangle \approx \langle h \rangle_{Q} := \sum_{k=1}^Q w_k h(\bm{\xi}_k)f_{\Xi}(\bm{\xi}_k).
\end{align*}
The approximated numerical flux then becomes
\begin{align}\label{eq:numericalFluxIPM}
 \bm{G}(\bm{\hat u}_{j}^n,\bm{\hat u}_{j+1}^{n}) = \langle \bm g(\mathcal{U}(\bm{\hat u}_j^n),\mathcal{U}(\bm{\hat u}_{j+1}^n))\bm{\varphi}^T\rangle^T_Q.
\end{align}
Note that the numerical flux requires evaluating the ansatz $\mathcal{U}(\bm{\hat u}_j^n)$. To simplify notation, we define $\bm{u}_{s}:\mathbb{R}^s \to \mathbb{R}^s$,
\begin{align*}
\bm{u}_{s}(\bm\Lambda):=\left( \nabla_{\bm{u}} s \right)^{-1}(\bm\Lambda),
\end{align*}
meaning that the IPM ansatz \eqref{eq:ansatz} at cell $j$ in timestep $n$ can be written as
\begin{align*}
\mathcal{U}(\bm{\hat u}_j^n) = \bm{u}_{s}(\bm{\hat{\lambda}}(\bm{\hat u}_j^n)^T \bm{\varphi}).
\end{align*}
The computation of the so called entropy variables $\bm{\hat\lambda}_j^n:=\bm{\hat\lambda}(\bm{\hat u}_j^n)$ requires solving the dual problem \eqref{eq:dualProblem} for the moment vector $\bm{\hat u}_{j}^{n}$. Hence, to determine the dual variables for a given moment vector $\bm{\hat{u}}$, the cost function
\begin{align}\label{eq:L}
L(\bm{\lambda};\bm{\hat{u}}) := \langle s_*(\bm{\lambda}^T \bm\varphi)\rangle_Q - \sum_{i\leq M}\bm{\lambda}_i^T \bm{\hat u}_i
\end{align}
needs to be minimized. Hence, one needs to find the root of
\begin{align*}
\nabla_{\bm{\lambda_i}}L(\bm{\lambda};\bm{\hat{u}}) = \langle \nabla s_*(\bm{\lambda}^T \bm\varphi)\bm\varphi^T\rangle_Q^T - \bm{\hat u}_i = \langle \bm u_s(\bm{\lambda}^T \bm\varphi)\bm\varphi^T\rangle_Q^T - \bm{\hat u}_i,
\end{align*}
where we used $\nabla s_* \equiv \bm u_s$. The root is usually determined by using Newton's method. For simplicity, let us define the full gradient of the Lagrangian to be $\nabla_{\bm{\lambda}}L(\bm{\lambda};\bm{\hat{u}})\in\mathbb{R}^{N\cdot p}$, i.e. we store all entries in a vector. Newton's method uses the iteration function $\bm{d}:\mathbb{R}^{N\times p}\times\mathbb{R}^{N\times p}\to\mathbb{R}^{N\times p}$,
\begin{align}\label{eq:dualIterationFunction}
\bm{d}(\bm{\lambda},\bm{\hat{u}}):= \bm{\lambda}-\bm{H}(\bm{\lambda})^{-1}\cdot\nabla_{\bm{\lambda}}L(\bm{\lambda};\bm{\hat{u}}),
\end{align}
where $\bm H\in\mathbb{R}^{p\cdot N\times p\cdot N}$ is the Hessian of \eqref{eq:L}, given by
\begin{align*}
\bm{H}(\bm{\lambda}) := \langle \nabla \bm{u}_{\bm{s}} (\bm{\lambda}^T\bm{\varphi})\otimes\bm{\varphi}\bm{\varphi}^T\rangle_Q^{T}.
\end{align*}
The function $\bm d$ will in the following be called dual iteration function. Now, the Newton iteration for spatial cell $j$ is given by
\begin{align}\label{eq:dualIteration1}
\bm{\lambda}^{(m+1)}_j = \bm{d}(\bm{\lambda}_j^{(m)},\bm{\hat{u}_j}).
\end{align}
The exact dual state is then obtained by computing the fixed point of $\bm{d}$, meaning that one converges the iteration \eqref{eq:dualIteration1}, i.e. $\bm{\hat\lambda}_j^n:=\bm{\hat\lambda}(\bm{\hat u_j^n})=\lim_{m\rightarrow\infty}\bm{d}(\bm{\lambda}_j^{(m)},\bm{\hat{u}_j^n})$.
To obtain a finite number of iterations for the iteration in cell $j$, a stopping criterion 
\begin{align}\label{eq:tauCrit}
\sum_{i=0}^p\left\Vert \nabla_{\bm{\lambda_i}}L(\bm{\lambda}_j^{(m)};\bm{\hat{u}}_j^n) \right\Vert < \tau
\end{align}
is used.

We now write down the entire scheme: To obtain a more compact notation, we define
\begin{align}\label{eq:momentIterationFunction}
\bm{c}\left(\bm{\lambda}_{\ell},\bm{\lambda}_c,\bm{\lambda}_r\right):= \langle \bm u_{s}(\bm{\lambda}_c^T\bm{\varphi})\bm{\varphi}^T\rangle_Q^T - \frac{\Delta t}{\Delta x}\left(\langle \bm g(\bm u_{s}(\bm{\lambda}_c^T\bm{\varphi}),\bm u_{s}(\bm{\lambda}_r^T\bm{\varphi}))\bm{\varphi}^T\rangle_Q^T-\langle \bm g(\bm u_{s}(\bm{\lambda}_{\ell}^T\bm{\varphi}),\bm u_{s}(\bm{\lambda}_c^T\bm{\varphi}))\bm{\varphi}^T\rangle_Q^T\right).
\end{align}
The moment iteration is then given by
\begin{align}\label{eq:momentIteration}
\bm{\hat u}_j^{n+1} = \bm{c}\left(\bm{\hat\lambda}(\bm{\hat u}_{j-1}^n),\bm{\hat\lambda}(\bm{\hat u}_{j}^n),\bm{\hat\lambda}(\bm{\hat u}_{j+1}^n)\right),
\end{align}
where the map from the moment vector to the dual variables, i.e. $\bm{\lambda}(\bm{\hat u}_{j}^n)$, is obtained by iterating
\begin{align}\label{eq:dualIteration}
\bm{\lambda}_j^{(m+1)} = \bm{d}(\bm{\lambda}_{j}^{(m)};\bm{\hat u}_j^{n}).
\end{align}
until condition \eqref{eq:tauCrit} is fulfilled. This gives Algorithm \ref{alg:IPM}.

\begin{algorithm}[H]
\begin{algorithmic}[1]
\For{$j=0$ to $N_x+1$}
\State $\bm{u}_j^0 \leftarrow \frac{1}{\Delta x} \int_{x_{j-1/ 2}}^{x_{j+1/ 2}} \langle u_{\text{IC}}(x, \cdot) \bm{\varphi} \rangle_Q dx$
\EndFor
\For{$n=0$ to $N_t$}
\For{$j=0$ to $N_x+1$}
\State $\bm{\lambda}_j^{(0)} \leftarrow \bm{\hat \lambda}_j^{n}$
\While{\eqref{eq:tauCrit} is violated}
\State $\bm{\lambda}_j^{(m+1)} \leftarrow \bm{d}(\bm{\lambda}_{j}^{(m)};\bm{\hat u}_j^{n})$
\State $m \leftarrow m+1$
\EndWhile
\State $\bm{\hat \lambda}_j^{n+1} \leftarrow \bm{\lambda}_j^{(m)}$
\EndFor
\For{$j=1$ to $N_x$}
\State $\bm{\hat u}_j^{n+1} \leftarrow \bm{c}(\bm{\hat \lambda}_{j-1}^{n+1},\bm{\hat \lambda}_j^{n+1},\bm{\hat \lambda}_{j+1}^{n+1})$
\EndFor
\EndFor
\end{algorithmic}
\caption{IPM algorithm}
\label{alg:IPM}
\end{algorithm}

\subsection{Properties of the kinetic flux}
\label{sec:costNumFlux}

A straight-forward implementation is ensured by the choice of the numerical flux \eqref{eq:numericalFluxIPM}. This choice of the numerical flux is common in the field of transport theory, where it is called the \textit{kinetic flux}. By simply taking moments of a given deterministic flux, the method can easily be applied to various physical problems whenever an implementation of $\bm g = \bm g(\bm u_\ell, \bm u_r)$ is available. Therefore, we call the proposed numerical method \textit{semi-intrusive}.

Moreover, by computing the numerical flux with a quadrature rule, we minimize numerical costs: When physical fluxes or source terms in the deterministic equation are polynomials, numerical fluxes for the SG moment system \eqref{eq:SGMomentSystem} can be computed analytically before running the program. Even when terms in the deterministic problem are not polynomials, an approximation which again allows a precomputation can be constructed \cite{debusschere2004numerical}. See for example \cite{hu2015stochastic,tryoen2010instrusive} for the numerical flux computation or \cite{hu2016stochastic} for the computation of source terms. However, analytically precomputing terms in the SG moment system is often less efficient than using techniques as stratified or latin hypercube sampling \cite[Section 6]{ghanem1998stochastic}. In the following, we briefly discuss the number of operations needed when precomputing integrals versus the use of a kinetic flux for Burgers' equation.

With the matrices $\bm C_i := \langle \bm\varphi\bm\varphi^T\varphi_i\rangle\in\mathbb{R}^{N\times N}$ the Burgers' SG moment system reads
\begin{align*}
\partial_t \bm{\hat u} + \partial_x \bm F(\bm{\hat u}) = 0
\end{align*}
with $F_i(\bm{\hat u}) = \frac12\bm{\hat u}^T\bm C_i\bm{\hat u}$. Note that $\bm{C}_i$ can be computed analytically, hence choosing a Lax-Friedrichs flux
\begin{align}\label{eq:numFluxAnalytic}
G_i^{(LF)}(\bm{\hat u}_{\ell},\bm{\hat u}_{r}) =\frac{1}{4}\left(\bm{\hat u}_{\ell}^T \bm{C}_i \bm{\hat u}_{\ell}+\bm{\hat u}_{r}^T \bm{C}_i \bm{\hat u}_{r}\right) - \frac{\Delta x}{2\Delta t}(\bm{\hat u}_{r}-\bm{\hat u}_{\ell})_i
\end{align}
requires no integral evaluations. Recall, that the numerical flux choice made in this work gives
\begin{align}\label{eq:numericalFluxIPMBurgers}
 \bm{G}(\bm{\hat u}_{\ell},\bm{\hat u}_{r}) = \sum_{k=1}^Q w_k g(\mathcal{U}(\bm{\hat u}_{\ell};\xi_k),\mathcal{U}(\bm{\hat u}_{r};\xi_k))\bm{\varphi}(\xi_k)f_{\Xi}(\xi_k),
\end{align}
where $\mathcal{U}$ is the SG ansatz \eqref{eq:SGClosure}. When the chosen deterministic flux $g$ is Lax-Friedrichs, the order of the polynomials inside the sum is $3M=3(N-1)$. Choosing a Gauss-Lobatto quadrature rule, $Q = \frac32 N -1$ quadrature points suffice for an exact computation of the numerical flux. Indeed, with this choice of quadrature points, the numerical fluxes \eqref{eq:numFluxAnalytic} and \eqref{eq:numericalFluxIPMBurgers} are equivalent. 
Counting the number of operations, one observes that our choice of the numerical flux \eqref{eq:numericalFluxIPMBurgers} is significantly cheaper: When computing and storing the values in a matrix $\bm A\in\mathbb{R}^{Q\times N}$ with entries $a_{ki} = \varphi_i(\xi_k)$ before running the program, the numerical flux \eqref{eq:numericalFluxIPMBurgers} can be split into two parts. First, we determine the SG solution at all quadrature points, i.e. we compute $\bm{u}^{(\ell)} := \bm A \bm{\hat u}_{\ell}$ and $\bm{u}^{(r)} := \bm A \bm{\hat u}_{r}$ which requires $O(N\cdot Q)$ operations. These solution values are then used to compute the numerical flux
\begin{align*}
G_i(\bm{\hat u}_{\ell},\bm{\hat u}_{r}) &= \sum_{k=1}^Q w_k g(u^{(\ell)}_k,u^{(r)}_k)a_{ki}f_{\Xi}(\xi_k),
\end{align*}
which again requires $O(N\cdot Q)$ operations, i.e. the costs are $O(N^2)$. The evaluation of \eqref{eq:numFluxAnalytic} however requires $O(N^3)$ operations. When not using a quadratic entropy in the IPM method, integrals cannot be evaluated analytically and quadrature rules are not exact. We will study the approximation properties of IPM with different quadrature orders in Section~TODO